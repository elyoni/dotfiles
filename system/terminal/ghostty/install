#!/usr/bin/env bash

DIR=$(dirname "${BASH_SOURCE[0]}")
DIR=$(cd -P "${DIR}" && pwd)

source "${DIR}"/../../utils/package/apt
source "${DIR}"/../../utils/package/github
source "${DIR}"/../../utils/smart_link


function _install_ghostty() # Install Ghostty terminal emulator from GitHub releases
{
    # Ghostty is typically distributed as a binary or through package managers
    # For Ubuntu/Debian, we'll use the latest GitHub release
    echo "Installing Ghostty..."

    # Check if already installed
    if command -v ghostty &> /dev/null; then
        echo "Ghostty is already installed"
        return 0
    fi

    # Install dependencies
    fast_apt_install "libgtk-4-1" "libadwaita-1-0"

    # Install from GitHub releases
    # Note: Adjust the repository and asset name based on actual Ghostty release structure
    install_github_release "ghostty-org/ghostty" "ghostty-.*linux-x86_64.*\\.tar\\.gz" "/usr/local/bin"
}

function verify() # Verify the installation
{
    if command -v ghostty &> /dev/null; then
        echo "✓ Ghostty is installed: $(ghostty --version)"

        # Check if config is linked
        if [ -L "$HOME/.config/ghostty/config" ]; then
            echo "✓ Config file is properly linked"
        else
            echo "✗ Config file is not linked"
            return 1
        fi

        return 0
    else
        echo "✗ Ghostty is not installed"
        return 1
    fi
}


function install()
{
    _install_ghostty

    # Create config directory if it doesn't exist
    mkdir -p "$HOME/.config/ghostty"

    # Link config file
    smart_link "${DIR}/config" "$HOME/.config/ghostty/config"
}

function help # Show a list of functions
{
    awk '/^function / && ! /^function _/' "$0"
}

if [ $# -eq 0 ]; then
    help
else
    "$@"
fi
